<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoinMaster Games</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .user-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .balance {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .balance-item {
            text-align: center;
        }

        .balance-item .value {
            font-size: 18px;
            font-weight: bold;
        }

        .balance-item .label {
            font-size: 12px;
            opacity: 0.8;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .game-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .game-card:hover {
            transform: translateY(-5px);
        }

        .game-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .game-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .game-description {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .game-rewards {
            font-size: 11px;
            opacity: 0.7;
        }

        .tournaments {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .tournaments h3 {
            margin-bottom: 15px;
            text-align: center;
        }

        .tournament-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .tournament-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .tournament-info {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .tournament-join {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 12px;
            width: 100%;
        }

        .tournament-join:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .loading {
            text-align: center;
            padding: 20px;
        }

        .error {
            background: rgba(255, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .success {
            background: rgba(0, 255, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .game-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ CoinMaster Games</h1>
            <p>–ò–≥—Ä–∞–π—Ç–µ –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –º–æ–Ω–µ—Ç—ã!</p>
        </div>

        <div class="user-info">
            <div class="balance">
                <div class="balance-item">
                    <div class="value" id="coins">0</div>
                    <div class="label">ü™ô –ú–æ–Ω–µ—Ç—ã</div>
                </div>
                <div class="balance-item">
                    <div class="value" id="gems">0</div>
                    <div class="label">üíé –î—Ä–∞–≥–æ—Ü–µ–Ω–Ω—ã–µ –∫–∞–º–Ω–∏</div>
                </div>
                <div class="balance-item">
                    <div class="value" id="level">1</div>
                    <div class="label">‚≠ê –£—Ä–æ–≤–µ–Ω—å</div>
                </div>
            </div>
        </div>

        <div id="games-section">
            <h3 style="margin-bottom: 15px; text-align: center;">üéØ –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–≥—Ä—ã</h3>
            <div class="game-grid" id="game-grid">
                <!-- –ò–≥—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

        <div class="tournaments">
            <h3>üèÜ –¢—É—Ä–Ω–∏—Ä—ã</h3>
            <div id="tournaments-list">
                <!-- –¢—É—Ä–Ω–∏—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>

        <div id="error" class="error" style="display: none;">
            <p id="error-message"></p>
        </div>

        <div id="success" class="success" style="display: none;">
            <p id="success-message"></p>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session');
        const userId = urlParams.get('user');
        const gameId = urlParams.get('game');

        // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        let userData = {
            coins: 0,
            gems: 0,
            level: 1
        };

        // –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–≥—Ä—ã
        const games = [
            {
                id: 'snake',
                name: '–ó–º–µ–π–∫–∞',
                description: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∏–≥—Ä–∞ –∑–º–µ–π–∫–∞',
                icon: 'üêç',
                rewards: '10-50 –º–æ–Ω–µ—Ç'
            },
            {
                id: 'tetris',
                name: '–¢–µ—Ç—Ä–∏—Å',
                description: '–°–æ–±–∏—Ä–∞–π—Ç–µ –ª–∏–Ω–∏–∏',
                icon: 'üß©',
                rewards: '20-100 –º–æ–Ω–µ—Ç'
            },
            {
                id: 'puzzle',
                name: '–ì–æ–ª–æ–≤–æ–ª–æ–º–∫–∞',
                description: '–†–µ—à–∞–π—Ç–µ –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∏',
                icon: 'üß©',
                rewards: '15-75 –º–æ–Ω–µ—Ç'
            },
            {
                id: 'memory',
                name: '–ü–∞–º—è—Ç—å',
                description: '–¢—Ä–µ–Ω–∏—Ä—É–π—Ç–µ –ø–∞–º—è—Ç—å',
                icon: 'üß†',
                rewards: '5-30 –º–æ–Ω–µ—Ç'
            }
        ];

        // –¢—É—Ä–Ω–∏—Ä—ã
        const tournaments = [
            {
                id: 'snake_tournament',
                name: '–¢—É—Ä–Ω–∏—Ä –∑–º–µ–π–∫–∏',
                game: 'snake',
                entryFee: 100,
                prizePool: 1000,
                participants: 15,
                maxParticipants: 50
            },
            {
                id: 'tetris_championship',
                name: '–ß–µ–º–ø–∏–æ–Ω–∞—Ç —Ç–µ—Ç—Ä–∏—Å–∞',
                game: 'tetris',
                entryFee: 500,
                prizePool: 5000,
                participants: 8,
                maxParticipants: 100
            }
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        async function initApp() {
            showLoading(true);
            
            try {
                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                await loadUserData();
                
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–≥—Ä
                displayGames();
                
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–æ–≤
                displayTournaments();
                
                showLoading(false);
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
                showLoading(false);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserData() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –∫ API
            userData = {
                coins: 1250,
                gems: 45,
                level: 5
            };
            
            updateBalance();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        function updateBalance() {
            document.getElementById('coins').textContent = userData.coins;
            document.getElementById('gems').textContent = userData.gems;
            document.getElementById('level').textContent = userData.level;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–≥—Ä
        function displayGames() {
            const gameGrid = document.getElementById('game-grid');
            gameGrid.innerHTML = '';

            games.forEach(game => {
                const gameCard = document.createElement('div');
                gameCard.className = 'game-card';
                gameCard.onclick = () => startGame(game.id);
                
                gameCard.innerHTML = `
                    <div class="game-icon">${game.icon}</div>
                    <div class="game-name">${game.name}</div>
                    <div class="game-description">${game.description}</div>
                    <div class="game-rewards">–ù–∞–≥—Ä–∞–¥–∞: ${game.rewards}</div>
                `;
                
                gameGrid.appendChild(gameCard);
            });
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–æ–≤
        function displayTournaments() {
            const tournamentsList = document.getElementById('tournaments-list');
            tournamentsList.innerHTML = '';

            tournaments.forEach(tournament => {
                const tournamentItem = document.createElement('div');
                tournamentItem.className = 'tournament-item';
                
                const canJoin = userData.coins >= tournament.entryFee && 
                               tournament.participants < tournament.maxParticipants;
                
                tournamentItem.innerHTML = `
                    <div class="tournament-name">${tournament.name}</div>
                    <div class="tournament-info">
                        –í–∑–Ω–æ—Å: ${tournament.entryFee} –º–æ–Ω–µ—Ç<br>
                        –ü—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥: ${tournament.prizePool} –º–æ–Ω–µ—Ç<br>
                        –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${tournament.participants}/${tournament.maxParticipants}
                    </div>
                    <button class="tournament-join" ${!canJoin ? 'disabled' : ''} 
                            onclick="joinTournament('${tournament.id}')">
                        ${canJoin ? '–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å' : '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç'}
                    </button>
                `;
                
                tournamentsList.appendChild(tournamentItem);
            });
        }

        // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
        function startGame(gameId) {
            const game = games.find(g => g.id === gameId);
            if (!game) return;

            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
            showSuccess(`–ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã "${game.name}"...`);
            
            // –°–∏–º—É–ª—è—Ü–∏—è –∏–≥—Ä—ã
            setTimeout(() => {
                const score = Math.floor(Math.random() * 1000) + 100;
                const rewards = calculateRewards(gameId, score);
                
                showSuccess(`–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –°—á–µ—Ç: ${score}. –ü–æ–ª—É—á–µ–Ω–æ: ${rewards.coins} –º–æ–Ω–µ—Ç, ${rewards.gems} –¥—Ä–∞–≥–æ—Ü–µ–Ω–Ω—ã—Ö –∫–∞–º–Ω–µ–π`);
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
                userData.coins += rewards.coins;
                userData.gems += rewards.gems;
                updateBalance();
                
                // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ –±–æ—Ç
                sendGameResult(gameId, score, rewards);
            }, 2000);
        }

        // –£—á–∞—Å—Ç–∏–µ –≤ —Ç—É—Ä–Ω–∏—Ä–µ
        function joinTournament(tournamentId) {
            const tournament = tournaments.find(t => t.id === tournamentId);
            if (!tournament) return;

            if (userData.coins < tournament.entryFee) {
                showError('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è —É—á–∞—Å—Ç–∏—è');
                return;
            }

            if (tournament.participants >= tournament.maxParticipants) {
                showError('–¢—É—Ä–Ω–∏—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω');
                return;
            }

            // –°–ø–∏—Å–∞–Ω–∏–µ –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤–∑–Ω–æ—Å–∞
            userData.coins -= tournament.entryFee;
            tournament.participants++;
            
            updateBalance();
            displayTournaments();
            
            showSuccess(`–í—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ —Ç—É—Ä–Ω–∏—Ä—É "${tournament.name}"!`);
        }

        // –†–∞—Å—á–µ—Ç –Ω–∞–≥—Ä–∞–¥
        function calculateRewards(gameId, score) {
            const baseRewards = {
                snake: { coins: 30, gems: 2 },
                tetris: { coins: 60, gems: 5 },
                puzzle: { coins: 45, gems: 3 },
                memory: { coins: 20, gems: 1 }
            };

            const base = baseRewards[gameId] || { coins: 25, gems: 2 };
            const multiplier = Math.min(score / 500, 2); // –ú–∞–∫—Å–∏–º—É–º x2

            return {
                coins: Math.floor(base.coins * (1 + multiplier)),
                gems: Math.floor(base.gems * (1 + multiplier * 0.5))
            };
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–≥—Ä—ã –≤ –±–æ—Ç
        function sendGameResult(gameId, score, rewards) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –∫ API –±–æ—Ç–∞
            console.log('Game result:', { gameId, score, rewards });
        }

        // –ü–æ–∫–∞–∑ –∑–∞–≥—Ä—É–∑–∫–∏
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // –ü–æ–∫–∞–∑ –æ—à–∏–±–∫–∏
        function showError(message) {
            const errorDiv = document.getElementById('error');
            const errorMessage = document.getElementById('error-message');
            
            errorMessage.textContent = message;
            errorDiv.style.display = 'block';
            
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // –ü–æ–∫–∞–∑ —É—Å–ø–µ—Ö–∞
        function showSuccess(message) {
            const successDiv = document.getElementById('success');
            const successMessage = document.getElementById('success-message');
            
            successMessage.textContent = message;
            successDiv.style.display = 'block';
            
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
