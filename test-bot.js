require('dotenv').config();
const { Telegraf } = require('telegraf');

// ะัะพััะฐั ะฒะตััะธั ะฑะพัะฐ ะดะปั ัะตััะธัะพะฒะฐะฝะธั
const bot = new Telegraf(process.env.BOT_TOKEN || '8479237154:AAGPnOMzFdHcOi6A5Y-gPxQnq2q7BHJULq8');

// ะะฑัะฐะฑะพััะธะบ ะบะพะผะฐะฝะดั /start
bot.start((ctx) => {
  const welcomeText = `๐ฎ <b>ะะพะฑัะพ ะฟะพะถะฐะปะพะฒะฐัั ะฒ CoinMaster!</b>

๐ ะัะธะฒะตั, ${ctx.from.first_name || 'ะะณัะพะบ'}!

๐ฏ <b>ะะพัััะฟะฝัะต ะธะณัั:</b>
โข ะะธะบัะพัะธะฝั - ะฟัะพะฒะตัััะต ัะฒะพะธ ะทะฝะฐะฝะธั
โข ะะฐะทะธะฝะพ - ะฐะทะฐััะฝัะต ะธะณัั ะฝะฐ ะผะพะฝะตัั
โข ะะปะธะบะตั - ะทะฐัะฐะฑะฐััะฒะฐะนัะต ะบะปะธะบะฐะผะธ
โข ะขััะฝะธัั - ัะพัะตะฒะฝัะนัะตัั ั ะดััะณะธะผะธ

๐ฐ <b>ะะฐั ะฑะฐะปะฐะฝั:</b>
๐ช ะะพะฝะตัั: 1000
๐ ะัะฐะณะพัะตะฝะฝัะต ะบะฐะผะฝะธ: 0
โญ ะฃัะพะฒะตะฝั: 1

๐ก <b>ะกะพะฒะตั:</b> ะัะฟะพะปัะทัะนัะต ะบะฝะพะฟะบะธ ะฝะธะถะต ะดะปั ะฝะฐะฒะธะณะฐัะธะธ!`;

  const keyboard = {
    inline_keyboard: [
      [
        { text: '๐ค ะัะพัะธะปั', callback_data: 'profile' },
        { text: '๐ฐ ะะฐะปะฐะฝั', callback_data: 'balance' }
      ],
      [
        { text: '๐ฏ ะะธะบัะพัะธะฝั', callback_data: 'quiz_menu' },
        { text: '๐ฐ ะะฐะทะธะฝะพ', callback_data: 'casino_menu' }
      ],
      [
        { text: '๐ ะะปะธะบะตั', callback_data: 'clicker_menu' },
        { text: '๐ ะขััะฝะธัั', callback_data: 'tournaments' }
      ],
      [
        { text: '๐ ะขะฐะฑะปะธัะฐ ะปะธะดะตัะพะฒ', callback_data: 'leaderboard' },
        { text: '๐ ะะฐะณะฐะทะธะฝ', callback_data: 'shop' }
      ],
      [
        { text: 'โ ะะพะดะดะตัะถะบะฐ', callback_data: 'support' }
      ]
    ]
  };

  ctx.reply(welcomeText, { 
    parse_mode: 'HTML', 
    reply_markup: keyboard 
  });
});

// ะะฑัะฐะฑะพััะธะบ callback-ะทะฐะฟัะพัะพะฒ
bot.on('callback_query', (ctx) => {
  const callbackData = ctx.callbackQuery.data;
  
  switch (callbackData) {
    case 'profile':
      ctx.answerCbQuery();
      ctx.editMessageText(`๐ค <b>ะัะพัะธะปั ะธะณัะพะบะฐ</b>

๐ <b>ID:</b> ${ctx.from.id}
๐ค <b>ะะผั:</b> ${ctx.from.first_name || 'ะะต ัะบะฐะทะฐะฝะพ'}
๐ <b>ะะตะณะธัััะฐัะธั:</b> ${new Date().toLocaleDateString('ru-RU')}
โญ <b>ะฃัะพะฒะตะฝั:</b> 1
๐ <b>ะะฟัั:</b> 0

๐ฐ <b>ะะฐะปััะฐ:</b>
๐ช ะะพะฝะตัั: 1000
๐ ะัะฐะณะพัะตะฝะฝัะต ะบะฐะผะฝะธ: 0

๐ <b>ะกัะฐัะธััะธะบะฐ ะธะณั:</b>
๐ฏ ะะณั ััะณัะฐะฝะพ: 0
๐ ะะพะฑะตะด: 0
๐ฐ ะะฐะทะธะฝะพ ะธะณั: 0
๐ ะะปะธะบะพะฒ: 0

๐ <b>ะัะตะผะธัะผ ััะฐััั:</b> โ ะะตะฐะบัะธะฒะตะฝ`, { 
        parse_mode: 'HTML',
        reply_markup: {
          inline_keyboard: [[
            { text: '๐ ะะปะฐะฒะฝะพะต ะผะตะฝั', callback_data: 'main_menu' }
          ]]
        }
      });
      break;
      
    case 'balance':
      ctx.answerCbQuery();
      ctx.editMessageText(`๐ฐ <b>ะะฐะปะฐะฝั ะธ ะฒะฐะปััะฐ</b>

๐ช <b>ะะพะฝะตัั:</b> 1000
๐ <b>ะัะฐะณะพัะตะฝะฝัะต ะบะฐะผะฝะธ:</b> 0

๐ก <b>ะะฐะบ ะทะฐัะฐะฑะพัะฐัั:</b>
โข ะะถะตะดะฝะตะฒะฝัะน ะฑะพะฝัั: 100 ะผะพะฝะตั
โข ะะธะบัะพัะธะฝั: 50-200 ะผะพะฝะตั
โข ะะปะธะบะตั ะธะณัะฐ
โข ะขััะฝะธัั ะธ ะดะพััะธะถะตะฝะธั

๐ <b>ะะพัััะฟะตะฝ ะตะถะตะดะฝะตะฒะฝัะน ะฑะพะฝัั!</b>`, { 
        parse_mode: 'HTML',
        reply_markup: {
          inline_keyboard: [
            [
              { text: '๐ ะะพะปััะธัั ะตะถะตะดะฝะตะฒะฝัะน ะฑะพะฝัั', callback_data: 'claim_bonus' }
            ],
            [
              { text: '๐ ะัะฟะธัั ะผะพะฝะตัั', callback_data: 'buy_coins' },
              { text: '๐ ะะปะฐะฒะฝะพะต ะผะตะฝั', callback_data: 'main_menu' }
            ]
          ]
        }
      });
      break;
      
    case 'quiz_menu':
      ctx.answerCbQuery();
      ctx.editMessageText(`๐ฏ <b>ะะธะบัะพัะธะฝั</b>

ะัะฑะตัะธัะต ะบะฐัะตะณะพัะธั ะธ ัะปะพะถะฝะพััั:

๐ <b>ะะฐัะตะณะพัะธะธ:</b>
โข ๐ฌ ะะธะฝะพ - ะฒะพะฟัะพัั ะพ ัะธะปัะผะฐั
โข ๐ต ะัะทัะบะฐ - ะผัะทัะบะฐะปัะฝัะต ะฒะพะฟัะพัั  
โข ๐ฌ ะะฐัะบะฐ - ะฝะฐััะฝัะต ัะฐะบัั
โข ๐ฎ ะะณัั - ะธะณัะพะฒะฐั ะธะฝะดััััะธั

โญ <b>ะกะปะพะถะฝะพััั:</b>
โข ๐ข ะะตะณะบะฐั - 50 ะผะพะฝะตั ะทะฐ ะฟะพะฑะตะดั
โข ๐ก ะกัะตะดะฝัั - 100 ะผะพะฝะตั + 10 ะดัะฐะณะพัะตะฝะฝัั ะบะฐะผะฝะตะน
โข ๐ด ะกะปะพะถะฝะฐั - 200 ะผะพะฝะตั + 25 ะดัะฐะณะพัะตะฝะฝัั ะบะฐะผะฝะตะน

โฑ๏ธ <b>ะัะตะผั ะฝะฐ ะฒะพะฟัะพั:</b> 15 ัะตะบัะฝะด
๐ <b>ะะพะปะธัะตััะฒะพ ะฒะพะฟัะพัะพะฒ:</b> 10`, { 
        parse_mode: 'HTML',
        reply_markup: {
          inline_keyboard: [
            [
              { text: '๐ฌ ะะธะฝะพ', callback_data: 'quiz_movies' },
              { text: '๐ต ะัะทัะบะฐ', callback_data: 'quiz_music' }
            ],
            [
              { text: '๐ฌ ะะฐัะบะฐ', callback_data: 'quiz_science' },
              { text: '๐ฎ ะะณัั', callback_data: 'quiz_games' }
            ],
            [
              { text: '๐ ะะปะฐะฒะฝะพะต ะผะตะฝั', callback_data: 'main_menu' }
            ]
          ]
        }
      });
      break;
      
    case 'casino_menu':
      ctx.answerCbQuery();
      ctx.editMessageText(`๐ฐ <b>ะะฐะทะธะฝะพ ะธะณัั</b>

๐ฐ <b>ะะฐั ะฑะฐะปะฐะฝั:</b> 1000 ะผะพะฝะตั

๐ฎ <b>ะะพัััะฟะฝัะต ะธะณัั:</b>

๐ฐ <b>ะกะปะพั-ะผะฐัะธะฝะฐ</b>
โข ะะธะฝะธะผะฐะปัะฝะฐั ััะฐะฒะบะฐ: 10 ะผะพะฝะตั
โข ะะฐะบัะธะผะฐะปัะฝะฐั ััะฐะฒะบะฐ: 1000 ะผะพะฝะตั
โข ะจะฐะฝั ะฒัะธะณัััะฐ: 30%

๐ฒ <b>ะะพััะธ</b>
โข ะะธะฝะธะผะฐะปัะฝะฐั ััะฐะฒะบะฐ: 20 ะผะพะฝะตั
โข ะะฐะบัะธะผะฐะปัะฝะฐั ััะฐะฒะบะฐ: 1000 ะผะพะฝะตั
โข ะจะฐะฝั ะฒัะธะณัััะฐ: 50%

๐ฏ <b>ะัะปะตัะบะฐ</b>
โข ะะธะฝะธะผะฐะปัะฝะฐั ััะฐะฒะบะฐ: 50 ะผะพะฝะตั
โข ะะฐะบัะธะผะฐะปัะฝะฐั ััะฐะฒะบะฐ: 1000 ะผะพะฝะตั
โข ะจะฐะฝั ะฒัะธะณัััะฐ: 48%

๐ <b>ะะปัะบะดะถะตะบ</b>
โข ะะธะฝะธะผะฐะปัะฝะฐั ััะฐะฒะบะฐ: 100 ะผะพะฝะตั
โข ะะฐะบัะธะผะฐะปัะฝะฐั ััะฐะฒะบะฐ: 1000 ะผะพะฝะตั
โข ะจะฐะฝั ะฒัะธะณัััะฐ: 49%

โ๏ธ <b>ะัะตะดัะฟัะตะถะดะตะฝะธะต:</b> ะะณัะฐะนัะต ะพัะฒะตัััะฒะตะฝะฝะพ!`, { 
        parse_mode: 'HTML',
        reply_markup: {
          inline_keyboard: [
            [
              { text: '๐ฐ ะกะปะพั-ะผะฐัะธะฝะฐ', callback_data: 'casino_slots' },
              { text: '๐ฒ ะะพััะธ', callback_data: 'casino_dice' }
            ],
            [
              { text: '๐ฏ ะัะปะตัะบะฐ', callback_data: 'casino_roulette' },
              { text: '๐ ะะปัะบะดะถะตะบ', callback_data: 'casino_blackjack' }
            ],
            [
              { text: '๐ ะะปะฐะฒะฝะพะต ะผะตะฝั', callback_data: 'main_menu' }
            ]
          ]
        }
      });
      break;
      
    case 'clicker_menu':
      ctx.answerCbQuery();
      ctx.editMessageText(`๐ <b>ะะปะธะบะตั ะธะณัะฐ</b>

๐ฐ <b>ะะพัะพะด ะทะฐ ะบะปะธะบ:</b> 1 ะผะพะฝะตัะฐ
โก <b>ะะฒัะพะบะปะธะบะตั:</b> 0 ะผะพะฝะตั/ัะตะบ
๐ช <b>ะะพะฝะตัั ะฒ ัะตััะธะธ:</b> 0
๐ <b>ะะปะธะบะพะฒ ะฒ ัะตััะธะธ:</b> 0

๐ง <b>ะะฐัะธ ัะปัััะตะฝะธั:</b>
โข ะฃัะธะปะตะฝะฝัะน ะฟะฐะปะตั: 0 ััะพะฒะตะฝั
โข ะะฒัะพะบะปะธะบะตั: 0 ััะพะฒะตะฝั  
โข ะะพะปะพัะฐั ััะบะฐ: 0 ััะพะฒะตะฝั
โข ะะธะทะฝะตั-ัะตะฝัั: 0 ััะพะฒะตะฝั

๐ก <b>ะะฐะบ ะธะณัะฐัั:</b>
ะะฐะถะธะผะฐะนัะต ะบะฝะพะฟะบั "ะะปะธะบ!" ะดะปั ะทะฐัะฐะฑะพัะบะฐ ะผะพะฝะตั. ะะพะบัะฟะฐะนัะต ัะปัััะตะฝะธั ะดะปั ัะฒะตะปะธัะตะฝะธั ะดะพัะพะดะฐ!`, { 
        parse_mode: 'HTML',
        reply_markup: {
          inline_keyboard: [
            [
              { text: '๐ ะะปะธะบ!', callback_data: 'clicker_click' }
            ],
            [
              { text: '๐ง ะฃะปัััะตะฝะธั', callback_data: 'clicker_upgrades' },
              { text: '๐ ะกัะฐัะธััะธะบะฐ', callback_data: 'clicker_stats' }
            ],
            [
              { text: '๐ ะะปะฐะฒะฝะพะต ะผะตะฝั', callback_data: 'main_menu' }
            ]
          ]
        }
      });
      break;
      
    case 'claim_bonus':
      ctx.answerCbQuery('๐ ะะพะปััะตะฝ ะตะถะตะดะฝะตะฒะฝัะน ะฑะพะฝัั: 100 ะผะพะฝะตั!');
      ctx.editMessageText(`๐ฐ <b>ะะฐะปะฐะฝั ะธ ะฒะฐะปััะฐ</b>

๐ช <b>ะะพะฝะตัั:</b> 1100 (+100)
๐ <b>ะัะฐะณะพัะตะฝะฝัะต ะบะฐะผะฝะธ:</b> 0

โ <b>ะะถะตะดะฝะตะฒะฝัะน ะฑะพะฝัั ะฟะพะปััะตะฝ!</b>

๐ก <b>ะะฐะบ ะทะฐัะฐะฑะพัะฐัั:</b>
โข ะะถะตะดะฝะตะฒะฝัะน ะฑะพะฝัั: 100 ะผะพะฝะตั
โข ะะธะบัะพัะธะฝั: 50-200 ะผะพะฝะตั
โข ะะปะธะบะตั ะธะณัะฐ
โข ะขััะฝะธัั ะธ ะดะพััะธะถะตะฝะธั`, { 
        parse_mode: 'HTML',
        reply_markup: {
          inline_keyboard: [
            [
              { text: '๐ ะัะฟะธัั ะผะพะฝะตัั', callback_data: 'buy_coins' },
              { text: '๐ ะะปะฐะฒะฝะพะต ะผะตะฝั', callback_data: 'main_menu' }
            ]
          ]
        }
      });
      break;
      
    case 'main_menu':
      ctx.answerCbQuery();
      ctx.reply(`๐ฎ <b>ะะพะฑัะพ ะฟะพะถะฐะปะพะฒะฐัั ะฒ CoinMaster!</b>

๐ ะัะธะฒะตั, ${ctx.from.first_name || 'ะะณัะพะบ'}!

๐ฏ <b>ะะพัััะฟะฝัะต ะธะณัั:</b>
โข ะะธะบัะพัะธะฝั - ะฟัะพะฒะตัััะต ัะฒะพะธ ะทะฝะฐะฝะธั
โข ะะฐะทะธะฝะพ - ะฐะทะฐััะฝัะต ะธะณัั ะฝะฐ ะผะพะฝะตัั
โข ะะปะธะบะตั - ะทะฐัะฐะฑะฐััะฒะฐะนัะต ะบะปะธะบะฐะผะธ
โข ะขััะฝะธัั - ัะพัะตะฒะฝัะนัะตัั ั ะดััะณะธะผะธ

๐ฐ <b>ะะฐั ะฑะฐะปะฐะฝั:</b>
๐ช ะะพะฝะตัั: 1000
๐ ะัะฐะณะพัะตะฝะฝัะต ะบะฐะผะฝะธ: 0
โญ ะฃัะพะฒะตะฝั: 1

๐ก <b>ะกะพะฒะตั:</b> ะัะฟะพะปัะทัะนัะต ะบะฝะพะฟะบะธ ะฝะธะถะต ะดะปั ะฝะฐะฒะธะณะฐัะธะธ!`, { 
        parse_mode: 'HTML',
        reply_markup: {
          inline_keyboard: [
            [
              { text: '๐ค ะัะพัะธะปั', callback_data: 'profile' },
              { text: '๐ฐ ะะฐะปะฐะฝั', callback_data: 'balance' }
            ],
            [
              { text: '๐ฏ ะะธะบัะพัะธะฝั', callback_data: 'quiz_menu' },
              { text: '๐ฐ ะะฐะทะธะฝะพ', callback_data: 'casino_menu' }
            ],
            [
              { text: '๐ ะะปะธะบะตั', callback_data: 'clicker_menu' },
              { text: '๐ ะขััะฝะธัั', callback_data: 'tournaments' }
            ],
            [
              { text: '๐ ะขะฐะฑะปะธัะฐ ะปะธะดะตัะพะฒ', callback_data: 'leaderboard' },
              { text: '๐ ะะฐะณะฐะทะธะฝ', callback_data: 'shop' }
            ],
            [
              { text: 'โ ะะพะดะดะตัะถะบะฐ', callback_data: 'support' }
            ]
          ]
        }
      });
      break;
      
    default:
      ctx.answerCbQuery('๐ง ะคัะฝะบัะธั ะฒ ัะฐะทัะฐะฑะพัะบะต!');
  }
});

// ะะฑัะฐะฑะพััะธะบ ะพัะธะฑะพะบ
bot.catch((err, ctx) => {
  console.error('Bot error:', err);
  ctx.reply('ะัะพะธะทะพัะปะฐ ะพัะธะฑะบะฐ. ะะพะฟัะพะฑัะนัะต ะฟะพะทะถะต ะธะปะธ ะพะฑัะฐัะธัะตัั ะฒ ะฟะพะดะดะตัะถะบั.');
});

// ะะฐะฟััะบ ะฑะพัะฐ
console.log('๐ ะะฐะฟััะบ CoinMaster Bot...');
console.log('๐ค ะะพั: @new_coinmaster_game_bot');
console.log('๐ฑ ะะฐะนะดะธัะต ะฑะพัะฐ ะฒ Telegram ะธ ะพัะฟัะฐะฒััะต /start');

bot.launch().then(() => {
  console.log('โ ะะพั ััะฟะตัะฝะพ ะทะฐะฟััะตะฝ!');
}).catch((error) => {
  console.error('โ ะัะธะฑะบะฐ ะทะฐะฟััะบะฐ ะฑะพัะฐ:', error);
});

// Graceful shutdown
process.once('SIGINT', () => bot.stop('SIGINT'));
process.once('SIGTERM', () => bot.stop('SIGTERM'));
